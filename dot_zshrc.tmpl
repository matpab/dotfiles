setopt HIST_IGNORE_SPACE
setopt SHARE_HISTORY

export ZSH="$HOME/.oh-my-zsh"

ZSH_THEME="agnoster"
ZSH_TMUX_AUTOSTART=true

if [[ "$TERM_PROGRAM" = "vscode" ]] && [[ "$VSCODE_INJECTION" = "1" ]]; then
          ZSH_TMUX_AUTOSTART=false
fi

ZSH_TMUX_AUTOCONNECT=false
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=5'

COMPLETION_WAITING_DOTS="true"

plugins=(
  git
  git-auto-fetch
  dotenv
  zsh-syntax-highlighting
  zsh-autosuggestions
  zsh-interactive-cd
  autojump
  chezmoi
  safe-paste
  ssh
  tldr
  vscode
  yarn
  nvm
  mvn
  npm
  dotnet
  docker
  docker-compose
  azure
  terraform
  tmux
  kubectl
  helm
  kubectx
  kube-ps1
{{- if eq .osid "darwin" }}
  macos
  xcode
  textmate
  brew
{{ end -}}
{{- if contains .osid "linux" }}
  sudo
  ubuntu
{{ end -}}
)

fpath=(/usr/local/share/zsh-completions:$fpath)
if type brew &>/dev/null; then
  FPATH=$(brew --prefix)/share/zsh/site-functions:$FPATH

  autoload -Uz compinit
  compinit
else
  autoload -U compinit && compinit
fi

source $ZSH/oh-my-zsh.sh

export NVM_DIR="$HOME/.nvm"

{{ if eq .chezmoi.os "darwin" -}}

[ -s "/opt/homebrew/opt/nvm/nvm.sh" ] && . "/opt/homebrew/opt/nvm/nvm.sh"  # This loads nvm
[ -s "/opt/homebrew/opt/nvm/etc/bash_completion.d/nvm" ] && . "/opt/homebrew/opt/nvm/etc/bash_completion.d/nvm"
[ -f /opt/homebrew/etc/profile.d/autojump.sh ] && . /opt/homebrew/etc/profile.d/autojump.sh

{{ end -}}

export PATH="${KREW_ROOT:-$HOME/.krew}/bin:$PATH"

prompt_dir() {
  prompt_segment 39d $CURRENT_FG '%~'
}

prompt_context() {
  if [[ "$USER" != "$DEFAULT_USER" || -n "$SSH_CLIENT" ]]; then
    prompt_segment black default "%(!.%{%F{yellow}%}.)$USER"
  fi
  prompt_segment white default "$(kube_ps1)"
}

prompt_end() {
  if [[ -n $CURRENT_BG ]]; then
    echo -n " %{%k%F{$CURRENT_BG}%}$SEGMENT_SEPARATOR"
  else
    echo -n "%{%k%}"
  fi
  echo -n "\n%{%F{$CURRENT_BG}%}$SEGMENT_SEPARATOR%{%f%}"
  CURRENT_BG=''
}

{{ if eq .osid "darwin" -}}

# The following lines have been added by Docker Desktop to enable Docker CLI completions.
fpath=(/Users/mpabel/.docker/completions $fpath)
autoload -Uz compinit
compinit
# End of Docker CLI completions

{{ end -}}

export AQUA_GLOBAL_CONFIG=${AQUA_GLOBAL_CONFIG:-}:${XDG_CONFIG_HOME:-$HOME/.config}/aquaproj-aqua/aqua.yaml
export PATH="${AQUA_ROOT_DIR:-${XDG_DATA_HOME:-$HOME/.local/share}/aquaproj-aqua}/bin:$HOME/.local/bin:$PATH"
[[ "$TERM_PROGRAM" == "vscode" ]] && . "$(code --locate-shell-integration-path zsh)"
